#!/bin/csh

### Checks Portmaster log for moved ports and 
### then changes their origin.

## test

## INIT section (don't change)

if (`grep moved portmaster.log` == "") then
  echo No moved ports to process, exiting!	> /dev/stderr
  exit 1
endif

if ($1 == "pm") then
  set pm=1
endif

## MAIN section

foreach a ("`grep moved portmaster.log`")
  set old=`echo "$a" | cut -d ' ' -f3`;
  set old_pm=`echo $old | cut -d '/' -f2`;
  set new=`echo "$a" | cut -d ' ' -f7`;

  if (pm == 1) then
    portmaster -o $new $old_pm
  else
    pkg set -yo $old\:$new;
  endif
end

